-- Elimina la base de datos si ya existe para evitar errores en la creación
DROP DATABASE IF EXISTS `recetas_db`;

-- Crea la base de datos con la codificación de caracteres adecuada
CREATE DATABASE `recetas_db` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Usa la base de datos que acabamos de crear
USE `recetas_db`;

-- Tabla para los usuarios
CREATE TABLE `usuarios` (
  `id_usuario` INT(11) NOT NULL AUTO_INCREMENT,
  `nombre_usuario` VARCHAR(50) NOT NULL,
  `email` VARCHAR(100) NOT NULL UNIQUE,
  `contrasena` VARCHAR(255) NOT NULL,
  `rol` ENUM('usuario', 'administrador') NOT NULL DEFAULT 'usuario',
  `fecha_registro` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_usuario`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Tabla para las recetas
CREATE TABLE `recetas` (
  `id_receta` INT(11) NOT NULL AUTO_INCREMENT,
  `titulo` VARCHAR(255) NOT NULL,
  `descripcion` TEXT,
  `ingredientes` TEXT NOT NULL,
  `pasos` TEXT NOT NULL,
  `imagen_url` VARCHAR(255),
  `tiempo_preparacion` INT(5),
  `porciones` INT(3),
  `id_usuario` INT(11) NOT NULL,
  `fecha_creacion` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_receta`),
  FOREIGN KEY (`id_usuario`) REFERENCES `usuarios`(`id_usuario`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Tabla para los comentarios
CREATE TABLE `comentarios` (
  `id_comentario` INT(11) NOT NULL AUTO_INCREMENT,
  `texto_comentario` TEXT NOT NULL,
  `id_usuario` INT(11) NOT NULL,
  `id_receta` INT(11) NOT NULL,
  `fecha_creacion` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_comentario`),
  FOREIGN KEY (`id_usuario`) REFERENCES `usuarios`(`id_usuario`) ON DELETE CASCADE,
  FOREIGN KEY (`id_receta`) REFERENCES `recetas`(`id_receta`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Tabla para las categorías y tags de las recetas
CREATE TABLE `categorias` (
  `id_categoria` INT(11) NOT NULL AUTO_INCREMENT,
  `nombre_categoria` VARCHAR(50) NOT NULL UNIQUE,
  PRIMARY KEY (`id_categoria`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Tabla de unión para las categorías (una receta puede tener varias categorías)
CREATE TABLE `recetas_categorias` (
  `id_receta_categoria` INT(11) NOT NULL AUTO_INCREMENT,
  `id_receta` INT(11) NOT NULL,
  `id_categoria` INT(11) NOT NULL,
  PRIMARY KEY (`id_receta_categoria`),
  FOREIGN KEY (`id_receta`) REFERENCES `recetas`(`id_receta`) ON DELETE CASCADE,
  FOREIGN KEY (`id_categoria`) REFERENCES `categorias`(`id_categoria`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Añade algunos datos iniciales para las categorías
INSERT INTO `categorias` (`nombre_categoria`) VALUES
('Plato Fuerte'),
('Postre'),
('Desayuno'),
('Entrada'),
('Bebida'),
('Vegetariano'),
('Vegano');